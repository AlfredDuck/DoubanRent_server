/*
*通用前端js部分
*/

$(document).ready(function(){

/*注册判断*/
//点击昵称输入框时
$("#signup #username").focus(function(){
   isMail();
});
//点击密码输入框时
$("#signup #password").focus(function(){
   isUsername();
});
//点击提交按钮时
$("#signup").submit(function(){
   if(!isMail()){
      return false;
   }
   if(!isUsername()){
      return false;
   }
   if(!isPassword()){
      return false;
   }
})

//判断邮箱格式
function isMail(){
   var mailtext = $("#mail").val();
   if(mailtext === ""){
      $("#mail_err").text("邮箱不能为空");
      $("#mail_err").css("color", "red");
      return false;
   }else{
      var mailreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
      //返回true或false
      var mailRight = mailreg.test(mailtext);
      if(!mailRight){
         //alert("邮箱格式错误");
         $("#mail_err").text("邮箱格式错误");
         $("#mail_err").css("color", "red");
         return false;
      }else return true;
   }
}
//判断昵称格式
function isUsername(){
   var usernameText = $("#signup #username").val();
   if(usernameText === ""){
      $("#signup #username_err").text("昵称不能为空");
      $("#signup #username_err").css("color", "red");
      return false;
   }else{
      var match1 = usernameText.match(/^[0-9A-Za-z-\u4e00-\u9fa5]{1,30}$/);
      //匹配只能是数字字母或汉字，数目不限
      //匹配成功则返回匹配的字符，否则返回null
      //alert(match1);
      if(match1 === null){
         $("#signup #username_err").text("昵称只能使用数字，字母或汉字");
         $("#signup #username_err").css("color", "red");
         return false;
      }else return true;
   }
}
//判断密码格式
function isPassword(){
  var passwordText = $("#password").val();
  if(passwordText === ""){
      $("#password_err").text("密码不能为空");
      $("#password_err").css("color", "red");
      return false;
  }else{
     var match1 = passwordText.match(/^[0-9A-Za-z]{6,16}$/);//匹配只能是数字或字母，6到16位
     if(match1 === null){
        $("#password_err").text("密码必须为6～16位数字或字母");
        $("#password_err").css("color", "red");
        return false;
     }else return true;
  }
}

/*登录流程判断*/
$("#login #submit").click(function(){
   if(!isMail()){}
   else if(!isPassword()){}
   else{
      var themail = $("#mail").val();
      var thepassword = $("#password").val();
      $.post("/login", {mail: themail, password: thepassword}, function(data, status){
        if(data === "not"){
           $("#mail_err").text("邮箱或密码错误");
           $("#mail_err").css("color", "red");
        }else{
           alert(data);
           window.location.href = "127.0.0.1:3000/user/" + data;
        }
      });
   }
});

/*修改密码判断*/



});













